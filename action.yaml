apiVersion: automation.cloudbees.io/v1alpha1
kind: action
name: 'parseconfig'
description: 'Parse Config File'

# These are only the properties that the DevOps team allows the devs to
# override in their yaml file. ${{ vars.* }} cannot be read inside a custom
# action, so they must be passed in as an input to the custom action. This
# also means all the vars must be defined on the platform.
inputs:
  CONFIG_FILE:
    description: 'asdf'
  I-CONTEXT:
    description: 'asdf'
  I-MVN-COMPILE-ARGS:
    description: 'asdf'
  I-MVN-TEST-ARGS:
    description: 'asdf'
  I-PY-TEST-ARGS:
    description: 'asdf'
  I-DOCKERFILE:
    description: 'asdf'

outputs:
  CONTEXT:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.CONTEXT }}
  MVN-COMPILE-ARGS:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.MVN-COMPILE-ARGS }}
  MVN-TEST-ARGS:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.MVN-TEST-ARGS }}
  PY-TEST-ARGS:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.PY-TEST-ARGS }}
  DOCKERFILE:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.DOCKERFILE }}
  SQ-PROJECT-KEY:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.SQ-PROJECT-KEY }}
  ARTIFACT-DESTINATION:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.ARTIFACT-DESTINATION }}
  KANIKO-BUILD-ARGS:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.KANIKO-BUILD-ARGS }}
  KANIKO-LABELS:
    description: 'asdf'
    value: ${{ steps.parseconfigcba.outputs.KANIKO-LABELS }}

runs:
  using: composite
  steps:
    - name: Parse Config
      id: parseconfigcba
      kind: build
      uses: docker://sbatchelder/platform-agent:parse-configv2
      shell: sh
      run: |
        python3 /tools/parse_config.py -f ${{ inputs.CONFIG_FILE }}
